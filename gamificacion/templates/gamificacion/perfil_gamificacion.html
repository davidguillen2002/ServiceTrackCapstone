{% extends "base.html" %}

{% block title %}Perfil Gamificación{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Perfil Gamificación</h1>

    <!-- Progreso Actual -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h4>Progreso Actual</h4>
            <div class="progress" style="height: 25px;">
                <div
                    id="progress-bar"
                    class="progress-bar"
                    role="progressbar"
                    style="width: 0%;"
                    aria-valuenow="0"
                    aria-valuemin="0"
                    aria-valuemax="100">
                    0 / 100
                </div>
            </div>
        </div>
    </div>

    <!-- Calificación Promedio -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body text-center">
            <h4>Calificación Promedio</h4>
            <div class="display-4 text-primary" id="calificacion-promedio">N/A</div>
            <div id="estrellas-calificacion"></div>
        </div>
    </div>

    <!-- Recomendaciones -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h4>Recomendaciones</h4>
            <div id="recomendaciones" class="row">
                {% for recomendacion in recomendaciones %}
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <i class="bi bi-lightbulb text-warning"></i>
                            {{ recomendacion }}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <p>No tienes recomendaciones por ahora. ¡Sigue así!</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Retos Disponibles -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h4>Retos Disponibles</h4>
            <div class="row" id="retos-disponibles">
                {% for reto in retos_disponibles %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">{{ reto.nombre }}</h5>
                            <p class="card-text">
                                {{ reto.descripcion }}<br>
                                <small class="text-muted">Requisito: {{ reto.requisito }} puntos</small>
                            </p>
                            <span class="badge bg-success">{{ reto.puntos_otorgados }} Puntos</span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-md-12">
                    <p>No hay retos disponibles en este momento. ¡Mantente atento!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Datos simulados (se reemplazarían con valores del backend)
        const progresoActual = {{ usuario.puntos|default:0 }};
        const calificacionPromedio = {{ usuario.calificacion_promedio|default:0 }};
        const recomendaciones = {{ recomendaciones|safe }};

        // Actualizar barra de progreso
        const progressBar = document.getElementById("progress-bar");
        progressBar.style.width = `${progresoActual}%`;
        progressBar.setAttribute("aria-valuenow", progresoActual);
        progressBar.textContent = `${progresoActual} / 100`;

        // Establecer color según porcentaje
        if (progresoActual < 50) {
            progressBar.classList.add("bg-danger");
        } else if (progresoActual < 80) {
            progressBar.classList.add("bg-warning");
        } else {
            progressBar.classList.add("bg-success");
        }

        // Actualizar calificación promedio
        const calificacionPromedioEl = document.getElementById("calificacion-promedio");
        calificacionPromedioEl.textContent = `${calificacionPromedio.toFixed(1)} de 5`;

        // Mostrar estrellas
        const estrellasCalificacion = document.getElementById("estrellas-calificacion");
        for (let i = 1; i <= 5; i++) {
            const starIcon = document.createElement("i");
            starIcon.classList.add("bi", i <= calificacionPromedio ? "bi-star-fill text-warning" : "bi-star text-muted");
            estrellasCalificacion.appendChild(starIcon);
        }
    });
</script>
{% endblock %}