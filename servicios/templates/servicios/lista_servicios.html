{% extends "base.html" %}

{% block title %}Gestión de Servicios{% endblock %}

{% block content %}
<div class="container">
    <h1>Gestión de Servicios</h1>
    <p>Consulta y gestiona los servicios técnicos asignados.</p>

    <div class="search-container mb-4">
        <form id="search-form">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" name="q" class="form-control" placeholder="Buscar servicios..." id="search-input">
                </div>
                <div class="col-md-4">
                    <select name="estado" class="form-select" id="estado-select">
                        <option value="">Filtrar por Estado</option>
                        {% for estado in estados %}
                            <option value="{{ estado }}">{{ estado }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </form>
    </div>

    <!-- Contenedor para mostrar los resultados de búsqueda -->
    <div id="service-list">
        {% include 'servicios/servicio_list.html' %}
    </div>
</div>

<!-- Script para búsqueda y filtrado en tiempo real con AJAX -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function searchServices() {
        const query = $('#search-input').val();
        const estado = $('#estado-select').val();

        $.ajax({
            url: '{% url "lista_servicios" %}',
            data: { q: query, estado: estado },
            dataType: 'json',
            success: function (data) {
                $('#service-list').html(data.html);
            }
        });
    }

    $('#search-input').on('keyup', searchServices);
    $('#estado-select').on('change', searchServices);
</script>
{% endblock %}